(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-67c9ad31"],{"2c3e":function(e,t,n){var a=n("83ab"),i=n("9f7f").MISSED_STICKY,o=n("c6b6"),r=n("edd0"),s=n("69f3").get,c=RegExp.prototype,l=TypeError;a&&i&&r(c,"sticky",{configurable:!0,get:function(){if(this!==c){if("RegExp"===o(this))return!!s(this).sticky;throw new l("Incompatible receiver, RegExp required")}}})},"3ebb":function(e,t,n){n.r(t),n("99af"),n("4de4"),n("d81d"),n("a434"),n("e9f5"),n("910d"),n("ab43"),n("e9c4"),n("d3b7");var a=n("e449"),i=n("b7be");a={name:"NewUserGift",components:{couponList:a.a},data:function(){return{spinShow:!1,formData:{reward_money:0,reward_integral:0,reward_coupon:[],updateIds:[]}}},created:function(){this.getInfo()},methods:{uniqueArray:function(e){var t={};return e.filter((function(e){return e.title="0.00"!==e.use_min_price?"".concat(e.title," | 满").concat(e.use_min_price,"元 减 ").concat(e.coupon_price,"元"):"".concat(e.title," | ").concat(e.coupon_price,"元 无门槛券"),delete e.use_min_price,delete e.coupon_price,e=JSON.stringify(e),!t[e]&&(t[e]=!0)}))},nameId:function(e,t){this.formData.reward_coupon=this.uniqueArray(t)},addCoupon:function(){this.$refs.couponTemplates.isTemplate=!0,this.$refs.couponTemplates.tableList()},handleClose:function(e){this.formData.reward_coupon.splice(e,1)},getInfo:function(){var e=this;this.spinShow=!0,Object(i.D)().then((function(t){e.spinShow=!1,e.formData=t.data,e.updateIds=t.data.reward_coupon.map((function(e){return e.id}))})).catch((function(t){e.spinShow=!1,e.$message.error("获取失败")}))},submitForm:function(){var e=this;this.spinShow=!0,Object(i.v)(this.formData).then((function(t){e.spinShow=!1,e.$message.success("提交成功")})).catch((function(t){e.spinShow=!1,e.$message.error("提交失败")}))}}},n=n("2877"),n=Object(n.a)(a,(function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.spinShow,expression:"spinShow"}]},[t("div",{staticClass:"article-manager"},[t("el-card",{staticClass:"ivu-mt fromBox",attrs:{bordered:!1,shadow:"never"}},[t("el-form",{ref:"formRef",attrs:{model:e.formData,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"赠送余额(元)："}},[t("el-input-number",{staticClass:"form-width",attrs:{placeholder:"请输入赠送余额",min:0},model:{value:e.formData.reward_money,callback:function(t){e.$set(e.formData,"reward_money",t)},expression:"formData.reward_money"}}),t("div",{staticClass:"tips-info"},[e._v("新用户奖励金额，必须大于等于0，0为不赠送")])],1),t("el-form-item",{attrs:{label:"赠送积分："}},[t("el-input-number",{staticClass:"form-width",attrs:{placeholder:"请输入赠送积分数量",min:0},model:{value:e.formData.reward_integral,callback:function(t){e.$set(e.formData,"reward_integral",t)},expression:"formData.reward_integral"}}),t("div",{staticClass:"tips-info"},[e._v("新用户奖励积分，必须大于等于0，0为不赠送")])],1),t("el-form-item",{attrs:{label:"赠送优惠券："}},[e.formData.reward_coupon.length?t("div",{staticClass:"mb10"},e._l(e.formData.reward_coupon,(function(n,a){return t("el-tag",{key:a,staticClass:"mr10",attrs:{closable:""},on:{close:function(t){return e.handleClose(a)}}},[e._v(e._s(n.title))])})),1):e._e(),t("el-button",{directives:[{name:"db-click",rawName:"v-db-click"}],on:{click:e.addCoupon}},[e._v("选择优惠券")])],1),t("el-form-item",{attrs:{label:""}},[t("el-button",{directives:[{name:"db-click",rawName:"v-db-click"}],attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确认")])],1)],1)],1)],1),t("coupon-list",{ref:"couponTemplates",attrs:{updateIds:e.updateIds},on:{nameId:e.nameId}})],1)}),[],!1,null,"0a4467de",null);t.default=n.exports},"4d63":function(e,t,n){var a=n("83ab"),i=n("cfe9"),o=n("e330"),r=n("94ca"),s=n("7156"),c=n("9112"),l=n("7c73"),u=n("241c").f,d=n("3a9b"),p=n("44e7"),f=n("577e"),m=n("90d8"),h=n("9f7f"),g=n("aeb0"),b=n("cb2d"),w=n("d039"),v=n("1a2d"),_=n("69f3").enforce,y=n("2626"),k=n("b622"),x=n("fce3"),S=n("107c"),D=k("match"),R=i.RegExp,I=R.prototype,C=i.SyntaxError,E=o(I.exec),$=o("".charAt),T=o("".replace),N=o("".indexOf),O=o("".slice),j=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,F=/a/g,L=/a/g,A=(n=new R(F)!==F,h.MISSED_STICKY),M=h.UNSUPPORTED_Y;k=a&&(!n||A||x||S||w((function(){return L[D]=!1,R(F)!==F||R(L)===L||"/a/i"!==String(R(F,"i"))})));if(r("RegExp",k)){for(var q=function(e,t){var n,a,i=d(I,this),o=p(e),r=void 0===t,u=[],h=e;if(!i&&o&&r&&e.constructor===q)return e;if((o||d(I,e))&&(e=e.source,r)&&(t=m(h)),e=void 0===e?"":f(e),t=void 0===t?"":f(t),h=e,o=t=x&&"dotAll"in F&&(n=!!t&&-1<N(t,"s"))?T(t,/s/g,""):t,A&&"sticky"in F&&(a=!!t&&-1<N(t,"y"))&&M&&(t=T(t,/y/g,"")),S&&(e=(r=(e=>{for(var t,n=e.length,a=0,i="",o=[],r=l(null),s=!1,c=!1,u=0,d="";a<=n;a++){if("\\"===(t=$(e,a)))t+=$(e,++a);else if("]"===t)s=!1;else if(!s)switch(!0){case"["===t:s=!0;break;case"("===t:if(i+=t,"?:"===O(e,a+1,a+3))continue;E(j,O(e,a+1))&&(a+=2,c=!0),u++;continue;case">"===t&&c:if(""===d||v(r,d))throw new C("Invalid capture group name");r[d]=!0,c=!(o[o.length]=[d,u]),d="";continue}c?d+=t:i+=t}return[i,o]})(e))[0],u=r[1]),r=s(R(e,t),i?this:I,q),(n||a||u.length)&&(t=_(r),n&&(t.dotAll=!0,t.raw=q((e=>{for(var t,n=e.length,a=0,i="",o=!1;a<=n;a++)"\\"===(t=$(e,a))?i+=t+$(e,++a):o||"."!==t?("["===t?o=!0:"]"===t&&(o=!1),i+=t):i+="[\\s\\S]";return i})(e),o)),a&&(t.sticky=!0),u.length)&&(t.groups=u),e!==h)try{c(r,"source",""===h?"(?:)":h)}catch(e){}return r},K=u(R),Y=0;K.length>Y;)g(q,R,K[Y++]);(I.constructor=q).prototype=I,b(i,"RegExp",q,{constructor:!0})}y("RegExp")},"61f7":function(e,t,n){n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return c})),n.d(t,"b",(function(){return l}));var a=n("ade3"),i=n("5530");function o(e,t){/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));var n,a,i={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds()};for(n in i)new RegExp("(".concat(n,")")).test(t)&&(a=i[n]+"",t=t.replace(RegExp.$1,1===RegExp.$1.length?a:("00"+a).substr(a.length)));return t}n("99af"),n("13d5"),n("e9f5"),n("9485"),n("b64b"),n("d3b7"),n("4d63"),n("c607"),n("ac1f"),n("2c3e"),n("00b4"),n("25f0"),n("5319"),n("498a");var r={min:"%s最小长度为:min",max:"%s最大长度为:max",length:"%s长度必须为:length",range:"%s长度为:range",pattern:"$s格式错误"};function s(e,t){e.message=function(e){return t.replace("%s",e||"")}}function c(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)({required:!0,message:e,type:"string"},t)}function l(e){return u.pattern(/(^[1-9]([0-9]+)?(\.[0-9]{1,2})?$)|(^(0){1}$)|(^[0-9]\.[0-9]([0-9])?$)/,e)}s(c,"请输入%s"),s(l,"%s格式不正确");var u=Object.keys(r).reduce((function(e,t){return e[t]=function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r="range"===t?{min:e[0],max:e[1]}:Object(a.a)({},t,e);return Object(i.a)(Object(i.a)({message:n.replace(":".concat(t),"range"===t?"".concat(e[0],"-").concat(e[1]):e),type:"string"},r),o)},s(e[t],r[t]),e}),{})},c607:function(e,t,n){var a=n("83ab"),i=n("fce3"),o=n("c6b6"),r=n("edd0"),s=n("69f3").get,c=RegExp.prototype,l=TypeError;a&&i&&r(c,"dotAll",{configurable:!0,get:function(){if(this!==c){if("RegExp"===o(this))return!!s(this).dotAll;throw new l("Incompatible receiver, RegExp required")}}})},e449:function(e,t,n){var a=n("2909"),i=(n("4de4"),n("caad"),n("14d9"),n("e9f5"),n("910d"),n("7d54"),n("4ec9"),n("d3b7"),n("2532"),n("3ca3"),n("159b"),n("ddb0"),n("b7be")),o=n("61f7"),r={name:"index",filters:{formatDate:function(e){if(0!==e)return e=new Date(1e3*e),Object(o.a)(e,"yyyy-MM-dd hh:mm")}},props:{couponids:{type:Array},updateIds:{type:Array},updateName:{type:Array},luckDraw:{type:Boolean,default:!1}},data:function(){return{templateRadio:0,currentid:0,productRow:{},isTemplate:!1,loading:!1,tableFrom:{receive_type:3,page:1,limit:15},total:0,ids:[],texts:[],couponList:[],selectedIds:[],selectedNames:[],multipleSelection:[]}},mounted:function(){},watch:{updateIds:function(e){this.selectedIds=e},updateName:function(e){this.selectedNames=e,this.multipleSelection=e}},created:function(){},methods:{getRowKey:function(e){return e.id},getTemplateRow:function(e){this.currentid=e.id,this.productRow=e},unique:function(e){var t=new Map;return e.filter((function(e){return!t.has(e.id)&&t.set(e.id,1)}))},changeCheckbox:function(e){for(var t=[],n=[],a=[],i=this.unique(e),o=0;o<i.length;o++){var r,s=i[o];a.includes(s.id)||(r={id:s.id,title:s.title,full_reduction:s.full_reduction,use_min_price:s.use_min_price,coupon_price:s.coupon_price},n.push(r),a.push(s.id),t.push(s))}this.selectedIds=a,this.selectedNames=n,this.multipleSelection=t},cancel:function(){this.isTemplate=!1,this.luckDraw&&(this.currentid=0)},tableList:function(){var e=this;this.loading=!0,Object(i.jb)(this.tableFrom).then((function(t){t=t.data,e.couponList=t.list,e.total=t.count,e.$nextTick((function(){e.selectedIds.length&&e.setChecked(),e.showSelectData()})),e.loading=!1}))},setChecked:function(){var e=this,t=Object(a.a)(this.selectedIds);this.couponList.forEach((function(n){t.includes(n.id)&&e.$refs.couponTable.toggleRowSelection(n,!0)}))},ok:function(){this.luckDraw?(this.$emit("getCouponId",this.productRow),this.currentid=0):this.$emit("nameId",this.selectedIds,this.selectedNames),this.isTemplate=!1},pageChange:function(e){this.tableFrom.page=e,this.tableList()},limitChange:function(e){this.tableFrom.limit=e,this.tableList()},showSelectData:function(){var e=this;0<this.multipleSelection.length&&this.couponList.forEach((function(t){e.multipleSelection.forEach((function(e){t.id,e.id}))}))}}};n=n("2877"),n=Object(n.a)(r,(function(){var e=this,t=e._self._c;return t("div",[t("el-dialog",{attrs:{visible:e.isTemplate,title:"优惠券列表","append-to-body":"",width:"1000px"},on:{"update:visible":function(t){e.isTemplate=t}}},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"couponTable",staticClass:"mt20",attrs:{data:e.couponList,"highlight-current-row":"","row-key":e.getRowKey,"no-userFrom-text":"暂无数据","no-filtered-userFrom-text":"暂无筛选结果"},on:{"selection-change":e.changeCheckbox}},[t("el-table-column",e.luckDraw?{attrs:{width:"50"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("el-radio",{attrs:{label:n.row.id},nativeOn:{change:function(t){return e.getTemplateRow(n.row)}},model:{value:e.templateRadio,callback:function(t){e.templateRadio=t},expression:"templateRadio"}},[e._v(" ")])]}}])}:{attrs:{type:"selection",width:"55","reserve-selection":!0}}),t("el-table-column",{attrs:{label:"ID",width:"70"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("span",[e._v(e._s(n.row.id))])]}}])}),t("el-table-column",{attrs:{label:"优惠券名称","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("span",[e._v(e._s(n.row.title))])]}}])}),t("el-table-column",{attrs:{label:"优惠券类型","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(n){return[1===n.row.type?t("span",[e._v("品类券")]):2===n.row.type?t("span",[e._v("商品券")]):3===n.row.type?t("span",[e._v("会员券")]):t("span",[e._v("通用券")])]}}])}),t("el-table-column",{attrs:{label:"面值","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("span",[e._v(e._s(n.row.coupon_price))])]}}])}),t("el-table-column",{attrs:{label:"最低消费额","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("span",[e._v(e._s(n.row.use_min_price))])]}}])}),t("el-table-column",{attrs:{label:"发布数量","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(n){return[n.row.is_permanent?t("span",[e._v("不限量")]):t("div",[t("span",{staticClass:"fa"},[e._v("发布："+e._s(n.row.total_count))]),t("span",{staticClass:"sheng ml10"},[e._v("剩余："+e._s(n.row.remain_count))])])]}}])}),t("el-table-column",{attrs:{label:"有效期限","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(n){return[n.row.start_time?t("div",[e._v("\n            "+e._s(e._f("formatDate")(n.row.start_time))+" - "+e._s(e._f("formatDate")(n.row.end_time))+"\n          ")]):t("span",[e._v("不限时")])]}}])}),t("el-table-column",{attrs:{label:"状态","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("el-tag",{directives:[{name:"show",rawName:"v-show",value:1===n.row.status,expression:"scope.row.status === 1"}],attrs:{size:"medium"}},[e._v("正常")]),t("el-tag",{directives:[{name:"show",rawName:"v-show",value:0===n.row.status,expression:"scope.row.status === 0"}],attrs:{size:"medium",type:"danger"}},[e._v("未开启")]),t("el-tag",{directives:[{name:"show",rawName:"v-show",value:-1===n.row.status,expression:"scope.row.status === -1"}],attrs:{size:"medium",type:"info"}},[e._v("已失效")])]}}])})],1),t("div",{staticClass:"acea-row row-right page"},[e.total?t("pagination",{attrs:{total:e.total,page:e.tableFrom.page,limit:e.tableFrom.limit},on:{"update:page":function(t){return e.$set(e.tableFrom,"page",t)},"update:limit":function(t){return e.$set(e.tableFrom,"limit",t)},pagination:e.tableList}}):e._e()],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{directives:[{name:"db-click",rawName:"v-db-click"}],on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{directives:[{name:"db-click",rawName:"v-db-click"}],attrs:{type:"primary"},on:{click:e.ok}},[e._v("确 定")])],1)],1)],1)}),[],!1,null,"71d107e2",null);t.a=n.exports}}]);